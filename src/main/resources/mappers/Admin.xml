<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
    <mapper namespace="com.camping.bit.dao.AdminDao">

    <select id="allMemberList" parameterType="MypageParam" resultType="MemberDto">
        SELECT ID, USERNAME, NICKNAME, PHONE, EMAIL, CREATE_DATE, SNS_TYPE ,AUTH
        FROM (
        SELECT ROW_NUMBER()OVER(ORDER BY USERNAME DESC) AS RNUM,
        ID, USERNAME, NICKNAME, PHONE, EMAIL, CREATE_DATE, SNS_TYPE, AUTH
        FROM MEMBER
        WHERE 1=1
        <if test="choice != null and choice != '' and search != null and search != ''">
            <if test="choice == 'id'">
                AND ID = #{search}
            </if>
            <if test="choice == 'username'">
                AND USERNAME = #{search}
            </if>
            <if test="choice == 'nickname'">
                AND NICKNAME = #{search}
            </if>
        </if>
        ORDER BY USERNAME DESC
        )
        WHERE RNUM BETWEEN #{start} AND #{end}
    </select>

    <!-- 멤버 수 -->
    <select id="memberCountSearch" parameterType="MypageParam" resultType="Integer">
        SELECT NVL(COUNT(*), 0)
        FROM MEMBER
        WHERE 1=1
        <if test="choice != null and choice != '' and search != null and search != ''">
            <if test="choice == 'id'">
                AND ID = #{search}
            </if>
            <if test="choice == 'username'">
                AND USERNAME = #{search}
            </if>
            <if test="choice == 'nickname'">
                AND NICKNAME = #{search}
            </if>
        </if>
    </select>

    <select id="memberCount" resultType="Integer">
        SELECT COUNT(*) FROM MEMBER WHERE AUTH = 0
    </select>

    <select id="getCommunity" parameterType="MypageParam" resultType="CommunityDto">
        SELECT COMMUNITY_SEQ, USER_ID, (SELECT NICKNAME FROM MEMBER WHERE ID = USER_ID) AS NICKNAME,
               TITLE, WDATE, CONTENT, READCOUNT, LIKECOUNT, DEL, BBSTYPE
        FROM (
            SELECT ROW_NUMBER()OVER(ORDER BY WDATE DESC) AS RNUM,
            COMMUNITY_SEQ, TITLE, WDATE, CONTENT, READCOUNT, LIKECOUNT, DEL, BBSTYPE, USER_ID
            FROM COMMUNITY_BBS
            WHERE 1=1
            AND BBSTYPE = #{bbstype}
            AND DEL = 0
                <if test="choice != null and choice != '' and search != null and search != ''">
                    <if test="choice == 'title'">
                        AND TITLE LIKE '%'||#{search}||'%'
                    </if>
                    <if test="choice == 'content'">
                        AND CONTENT LIKE '%'||#{search}||'%'
                    </if>
                    <if test="choice == 'writer'">
                        AND (SELECT NICKNAME FROM MEMBER WHERE ID = USER_ID) = #{search}
                    </if>
                </if>
            ORDER BY WDATE DESC
            )
        WHERE RNUM BETWEEN #{start} AND #{end}
    </select>

    <!--글의 총수 -->
    <select id="getCommunityCount" parameterType="MypageParam" resultType="Integer">
        SELECT NVL(COUNT(*), 0)
        FROM COMMUNITY_BBS
        WHERE 1=1
        AND BBSTYPE = #{bbstype}
        AND DEL = 0
        <if test="choice != null and choice != '' and search != null and search != ''">
            <if test="choice == 'title'">
                AND TITLE LIKE '%'||#{search}||'%'
            </if>
            <if test="choice == 'content'">
                AND CONTENT LIKE '%'||#{search}||'%'
            </if>
            <if test="choice == 'writer'">
                AND (SELECT NICKNAME FROM MEMBER WHERE ID = USER_ID) = #{search}
            </if>
        </if>
    </select>

  </mapper>