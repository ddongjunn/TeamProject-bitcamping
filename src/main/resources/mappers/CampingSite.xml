<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
    <mapper namespace="com.camping.bit.dao.CampingDao">
    <!-- 캠핑장 리스트 출력 -->
  	<!-- <select id="getCampingList" parameterType = "CampingListDto" resultType="CampingListDto">
  		SELECT * FROM CAMPING_LIST ORDER BY FIRSTIMAGEURL ASC
  	</select> -->
  	<select id = "getCampingList" parameterType = "CampingParam" resultType = "CampingListDto">
  		SELECT * FROM
		(SELECT ROW_NUMBER()OVER(ORDER BY FIRSTIMAGEURL) AS RNUM, 
		CONTENTID, FACLTNM, ADDR1, FIRSTIMAGEURL, LINEINTRO, TEL, HOMEPAGE, READCOUNT, LIKECOUNT
		FROM CAMPING_LIST 
		WHERE 1=1 
		<if test="searchDo != null and searchDo !=''">
    	AND DONM in	
        <foreach item="item" index="index" collection="searchDo" open="(" separator="," close=")">
            #{item}
        </foreach>
		</if>
		
		ORDER BY
			<choose>
				<when test = "sorting=='create'">
					CREATEDTIME DESC)
				</when>
				<when test = "sorting=='update'">
					MODIFIEDTIME DESC)
				</when>
				<when test = "sorting=='read'">
					READCOUNT DESC)
				</when>
				<when test = "sorting=='like'">
					LIKECOUNT DESC)
				</when>
				<otherwise>
					FIRSTIMAGEURL ASC)
				</otherwise>
			</choose>
			WHERE RNUM BETWEEN ${start} AND ${end}
  	</select>
  	
  	<!-- 캠핑장 상세화면 출력 -->
  	 <select id="getCampingDetail" parameterType = "java.lang.Integer" resultType="CampingDetailDto">
  		SELECT * FROM CAMPING_DETAIL WHERE CONTENTID = #{contentid}
  	</select>
  	
  	<!-- 캠핑장 상세화면용 리스트정보 끌어오기 -->
  	<select id="getCampingListForDetail" parameterType = "java.lang.Integer" resultType="CampingListDto">
  		SELECT * FROM CAMPING_LIST WHERE CONTENTID = #{contentid}
  	</select>
  	
  	<!-- 캠핑장 총 갯수 구하기 -->
	<select id = "getCampingCount" parameterType = "CampingParam" resultType="java.lang.Integer">
		SELECT NVL(COUNT(*),0) FROM CAMPING_LIST
	</select>
	
	<!-- 캠핑장 클릭시 조회수 증가시키기 -->
	<update id="getCampingReadcount" parameterType = "java.lang.Integer" >
		UPDATE CAMPING_LIST SET READCOUNT=READCOUNT+1 WHERE CONTENTID = #{contentid} 
	</update>
	
	<!-- 캠핑장 세부 사진 가져오기 -->
	<select id = "getCampingImage" parameterType = "java.lang.Integer" resultType = "CampingImageDto">
		SELECT * FROM CAMPING_IMG WHERE CONTENTID = #{contentid}
	</select>
	
	<!-- 캠핑장 intro 가져오기 -->
	<select id = "getCampingIntro" parameterType = "java.lang.Integer" resultType = "java.lang.String">
		SELECT INTRO FROM CAMPING_INTRO WHERE CONTENTID = #{contentid}
	</select>
	
  </mapper>