<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
    <mapper namespace="com.camping.bit.dao.CampingDao">
    <!-- 캠핑장 리스트 출력 -->
  	<!-- <select id="getCampingList" parameterType = "CampingListDto" resultType="CampingListDto">
  		SELECT * FROM CAMPING_LIST ORDER BY FIRSTIMAGEURL ASC
  	</select> -->
  	<select id = "getCampingList" parameterType = "CampingParam" resultType = "CampingListDto">
  		SELECT * FROM
		(SELECT ROW_NUMBER()OVER(ORDER BY FIRSTIMAGEURL) AS RNUM, 
		CONTENTID, FACLTNM, ADDR1, FIRSTIMAGEURL, LINEINTRO, TEL, HOMEPAGE, READCOUNT, LIKECOUNT
		FROM CAMPING_LIST 
		WHERE 1=1 
 		<if test="searchDo != null and searchDo !=''"><!-- 지역구분 -->
    	AND DONM in	
	        <foreach item="item" index="index" collection="searchDo" open="(" separator="," close=")">
	            #{item}
	        </foreach>
		</if> 
		<if test="searchCl != null and searchCl !=''"><!-- 캠핑장운영주체 -->
    	AND FACLTDIVNM in	
	        <foreach item="item" index="index" collection="searchCl" open="(" separator="," close=")">
	            #{item}
	        </foreach>
		</if> 
 		<!-- <if test="lctCl != null and lctCl !=''">캠핑장 주변환경
    	AND REGEXP_LIKE (LCTCL,
	        <foreach item="item" index="index" collection="lctCl" open="(" separator="," close=")">
	         	#{item})
	        </foreach>
	    </if> --> 
	   	<if test="lctCl != null and lctCl !=''"><!-- 캠핑장 시설분류 -->
			<trim prefix = "AND(" prefixOverrides="OR" suffix=")">
				<foreach item="item" index="index" collection="lctCl" separator=" ">
		    	 OR LCTCL like '%'||#{item}||'%'
			    </foreach>
		    </trim>   
		</if>
		<if test="induty != null and induty !=''"><!-- 캠핑장 시설분류 -->
			<trim prefix = "AND(" prefixOverrides="OR" suffix=")">
				<foreach item="item" index="index" collection="induty" separator=" ">
		    	 OR INDUTY like '%'||#{item}||'%'
			    </foreach>
		    </trim>   
		</if>
		<if test="resveCl != null and resveCl !=''"><!-- 캠핑장 시설분류 -->
			<trim prefix = "AND(" prefixOverrides="OR" suffix=")">
				<foreach item="item" index="index" collection="resveCl" separator=" ">
		    	 OR RESVECL like '%'||#{item}||'%'
			    </foreach>
		    </trim>   
		</if> 
		<if test="eqpmnLendCl != null and eqpmnLendCl !=''"><!-- 장비 대여 가능 여부 -->
    	AND EQPMNLENDCL != 'none'
		</if> 
		<if test="exprnProgrm != null and exprnProgrm !=''"><!-- 체험프로그램 여부 -->
    	AND EXPRNPROGRM != 'none'	
		</if> 
		<if test="animalCmgCl != null and animalCmgCl !=''"><!-- 애완동물 동반 가능 여부 -->
			<trim prefix = "AND(" prefixOverrides="OR" suffix=")">
				<foreach item="item" index="index" collection="animalCmgCl" separator=" ">
		    	 OR ANIMALCMGCL like '%'||#{item}||'%'
			    </foreach>
		    </trim>   
		</if> 
		<if test="sbrsCl != null and sbrsCl !=''"><!-- 캠핑장 시설분류 -->
			<trim prefix = "AND(" prefixOverrides="OR" suffix=")">
				<foreach item="item" index="index" collection="sbrsCl" separator=" ">
		    	 OR SBRSCL like '%'||#{item}||'%'
			    </foreach>
		    </trim>   
		</if> 
		<if test="siteBottomCl1 != null and siteBottomCl1 !=''"><!-- 캠핑장 바닥 잔디-->
		AND siteBottomCl1 != 0
		</if> 
		<if test="siteBottomCl2 != null and siteBottomCl2 !=''"><!-- 캠핑장 바닥 데크 -->
		AND siteBottomCl2 != 0
		</if> 
		<if test="siteBottomCl3 != null and siteBottomCl3 !=''"><!-- 캠핑장 바닥 파쇄석 -->
		AND siteBottomCl3 != 0
		</if> 
		<if test="siteBottomCl4 != null and siteBottomCl4 !=''"><!-- 캠핑장 바닥 자갈 -->
		AND siteBottomCl4 != 0
		</if> 
		<if test="siteBottomCl5 != null and siteBottomCl5 !=''"><!-- 캠핑장 바닥 잔디맨흙 -->
		AND siteBottomCl5 != 0
		</if> 
		
		<if test="doNm != null and doNm !=''"><!-- 도 -->
		AND DONM = #{doNm}
		</if>
		<if test="sigunguNm != null and sigunguNm !=''"><!-- 시군구 -->
		AND SIGUNGUNM = #{sigunguNm}
		</if>
		<if test="searchWord != null and searchWord !=''"><!-- 검색어 -->
		AND FACLTNM LIKE '%'||#{searchWord}||'%'
		</if>
	
		ORDER BY
			<choose>
				<when test = "sorting=='create'">
					CREATEDTIME DESC)
				</when>
				<when test = "sorting=='update'">
					MODIFIEDTIME DESC)
				</when>
				<when test = "sorting=='read'">
					READCOUNT DESC)
				</when>
				<when test = "sorting=='like'">
					LIKECOUNT DESC)
				</when>
				<otherwise>
					FIRSTIMAGEURL ASC)
				</otherwise>
			</choose>
			WHERE RNUM BETWEEN ${start} AND ${end}
  	</select>
  	
  	<!-- 캠핑장 상세화면 출력 -->
  	 <select id="getCampingDetail" parameterType = "java.lang.Integer" resultType="CampingDetailDto">
  		SELECT * FROM CAMPING_DETAIL WHERE CONTENTID = #{contentid}
  	</select>
  	
  	<!-- 캠핑장 상세화면용 리스트정보 끌어오기 -->
  	<select id="getCampingListForDetail" parameterType = "java.lang.Integer" resultType="CampingListDto">
  		SELECT * FROM CAMPING_LIST WHERE CONTENTID = #{contentid}
  	</select>
  	
  	<!-- 캠핑장 총 갯수 구하기 -->
	<select id = "getCampingCount" parameterType = "CampingParam" resultType="java.lang.Integer">
		SELECT NVL(COUNT(*),0) FROM CAMPING_LIST
	</select>
	
	<!-- 캠핑장 클릭시 조회수 증가시키기 -->
	<update id="getCampingReadcount" parameterType = "java.lang.Integer" >
		UPDATE CAMPING_LIST SET READCOUNT=READCOUNT+1 WHERE CONTENTID = #{contentid} 
	</update>
	
	<!-- 캠핑장 세부 사진 가져오기 -->
	<select id = "getCampingImage" parameterType = "java.lang.Integer" resultType = "CampingImageDto">
		SELECT * FROM CAMPING_IMG WHERE CONTENTID = #{contentid}
	</select>
	
	<!-- 캠핑장 intro 가져오기 -->
	<select id = "getCampingIntro" parameterType = "java.lang.Integer" resultType = "java.lang.String">
		SELECT INTRO FROM CAMPING_INTRO WHERE CONTENTID = #{contentid}
	</select>
	
	<!-- 캠핑장 검색시에 자동 검색어 만들기 -->
	<select id="autoSearch" parameterType = "java.lang.String" resultType = "CampingListDto">
		SELECT FACLTNM FROM CAMPING_LIST WHERE FACLTNM LIKE '%'||#{searchWord}||'%' ORDER BY READCOUNT DESC
	</select>
  </mapper>